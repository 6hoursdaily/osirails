<!-- store all attributes by model onto the page to avoid useless database request-->
<% javascript_tag do %>
  var ACTIONS = <%= HasSearchIndex::ACTIONS_TEXT.to_json.to_s %>;
  var DATA_TYPES = <%= HasSearchIndex::ClassMethods::ACTIONS.to_json.to_s %>;
  var ID = 0;
  var MODELS = new Hash();
  <% @models.each do |model| %>
    MODELS.set('<%= model %>', new Hash(<%=  model.constantize.search_index[:attributes].merge(model.constantize.search_index[:additional_attributes]).to_json %>));
  <% end %>
<% end %>

<% content_for :header do %>
     <%= javascript_include_tag 'has_search_index/search_index' %>
     <%= javascript_include_tag :defaults %> 
<% end %>
 

<h1>Rechercher</h1>

<div class="frame presentation_medium">

<% form_remote_tag :url => "search_index/update", :update => "search_result" do %>

  <h3>Que cherchez vous?</h3>

    <p><select id="model_select" name="model" onchange="get_attributes_select(false);">
      <option selected='selected' value="blank">Veuillez choisir la ressource</option>
      <% @models.each do |model| %>
        <%= "<option value='#{ model.to_s }'>#{ model.to_s.tableize.titleize }</option>" %>  
      <% end %>
    </select><p>
    
  <h3>Quels sont les crit&egrave;res?</h3>
  
    <p>
      respecter 
      <select name="search_type">
        <option value="or">l&apos;un des crit&egrave;res</option>
        <option value="and">tous les crit&egrave;res</option>
        <option value="not">aucun des crit&egrave;res</option>
      </select>
    </p>
    
    <div id="criteria_div">
    </div>
    <div style='display:none;' id='add_link' >
      <p><a href='#' onclick='get_attributes_select(true);'><img src='/images/add_16x16.png'/></a></p>
      <p><%= submit_tag "search"%><p>
    </div>

<% end %>

  <div id="search_result">
  </div>

</div>
