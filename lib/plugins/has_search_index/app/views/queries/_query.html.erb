<%
  page_config     = HasSearchIndex::HTML_PAGES_OPTIONS[query.page_name.to_sym].clone
  per_page_config = page_config[:per_page] + [['all', nil]]
  search_type_config = [['tous les critères','and'],['Au moins un critère','or'],['Aucuns critères','not']]
%>

<div class="presentation_medium integrated_search_form">

<% form_for(query) do |form| %>
  <%= form.error_messages %>
  <p>
    <%= form.label :name %>
    <%= form.text_field(:name) %>
  </p>
  <p>
    <%= form.label :public_access %>
    <%= form.check_box(:public_access , {}, true, false) %>
  </p>
  
  <%= render(:partial => "has_search_index/criteria_form", :locals => {:query => query})%>
  
  <fieldset>
    <legend class='not-collapsed' onclick="toggle_fieldset('<%= query.page_name %>', this);">Options</legend>
    <div>
    <% unless page_config[:group].empty? %>
      <div class='inline_div'> 
        <%= form.label :group %>
        <%= render :partial => 'shared/sortable_selects',
                   :locals => {:selected => query.group || [], :all => page_config[:group], :suffix => 'group'}%>
      </div>
    <% end %>
    
    <% unless page_config[:columns].empty? %>
      <div class='inline_div'>
        <%= form.label :columns %>
        <%= render :partial => 'shared/sortable_selects',
                   :locals => {:selected => query.columns, :all => page_config[:columns], :suffix => 'columns'}%>
      </div>
    <% end %>
    
    <% unless page_config[:order].empty? %>
      <div class='inline_div'>
        <%= form.label :order %>
        <div>
          <%= render :partial => "shared/order_option", :collection => query.order || [], :locals => {:page_config => page_config}%>
        </div>
        <div class='add_order_link'>
          <%= add_order_link(page_config)%>
        </div>
      </div>
    <% end %>
    
    <% unless page_config[:per_page].empty? %>
      <p>
        <%= form.label :per_page %>
        <%= form.form_or_view(select_tag("query[per_page]", options_for_select(per_page_config, query.per_page)), :per_page) %>
      </p>
    <% end %>
    </div>
  </fieldset>
  
  <%= hidden_field_tag('return_uri', @return_uri)%>
  <%= hidden_field_tag('query[page_name]', query.page_name)%>
  
  <%= form.form_buttons(:onclick => "valid_select_options('group columns');") %>
<% end %>
</div>
