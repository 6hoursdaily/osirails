<% content_for :header do %>
  <%= javascript_include_tag 'has_number/number' %> 
<% end %>

<%
  require_locals numbers_owner
  params_name ||= numbers_owner.class.name.downcase # permit to pass another params_name, for example into contact_picker
  hack_params ||= numbers_owner.is_a?(Contact)  # used to determine, in customer form, if an hidden field is needed to link the number to his respective contact, It may be deleted when the bug (see customer_controller) will be resolved. Also used for new contact form into contact_picker.
%>

<div class="number">
<% fields_for "#{ params_name }[number_attributes][]", number, :index => nil do |form| %>
	<%= form.error_messages %>
	<p>
	  <% if form.form_view? %>
	    <%= form.collection_select(:indicative_id, Indicative.find(:all), :id, :indicative, {}, { :selected => number[:indicative_id] }) %>
			<%= form.text_field(:number, { :size => 9, :maxlength => 9 }) %>
    	<%= form.collection_select(:number_type_id, NumberType.find(:all), :id, :name, {}, { :selected => number[:number_type_id] }) %>
    	<%= form.select :visible, Number::VISIBLE_STATES %>
	    
	    <%= number.new_record? ? remove_number_link : remove_old_number_link %>
	    <%= form.hidden_field("has_number_id", :value => numbers_owner.id, :class => 'has_number_id') if hack_params %>
	    <%= form.hidden_field :id %>
		  <%= form.hidden_field :should_destroy, :class => 'should_destroy_number' %>
	  <% else %>
	    <strong><%= display_full_phone_number(number) %></strong>
	  <% end %>
	</p>
<% end %>
</div>
