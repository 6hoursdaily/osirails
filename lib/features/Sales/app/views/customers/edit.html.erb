<h4>Modifier un client </h4>

    <% form_for(@customer) do |customer| %>
    <%= customer.error_messages %>

    <%= render :partial => 'thirds/third', :locals => {:third => customer, :type => "client"} %>

    <% if @establishments.length > 0 %>
    <% for establishment in @establishments %>
    <%= error_messages_for("establishment#{establishment.id}") %>
    <%= error_messages_for("establishment#{establishment.id}_address") %>
    <% end %>
      
    <fieldset>
      <legend> Informations concernant les établissement du client </legend>
      <% for establishment in @establishments %>
      <% unless establishment.activated == false %>
      <div <%= "id='establishment#{establishment.id}'" %>>
        <% cpt ||= 0 %>
        <% cpt += 1 %>

        <% # Display errors message for l%>
        <% unless @error%>
        <% establishment_name =establishment.name %>
        <% establishment_type = establishment.establishment_type_id %>
        <% establishment_address1 = establishment.address.address1 %>
        <% establishment_address2 = establishment.address.address2 %>
        <% end %>      
        <% # Mettre toutes ces variable dans un hash et envoyer ce has au render -%>

        <%= render :partial => 'customer_establishment', :locals => {:establishment => establishment} %>

        </div>
        <% end %>
        <% end %>  
        <% end %> 
        
        <% params[:new_establishment_number].nil? ? new_number_form = 0 : new_number_form = @new_number_form -%>
        <% # new_establishment_number store establishment number present in establishment_form -%>
        <%= hidden_field("new_establishment_number", "value", "value" => new_number_form) %>

        <% unless params[:new_establishment_number].nil? -%>        
        <% new_establishment_number = params[:new_establishment_number]["value"].to_i -%>
        <% new_establishment_number.times do |i| -%>
        <%= error_messages_for("new_establishment#{i+1}") %>
        <% end -%>

        <% end -%>
      
        <fieldset>
          <legend> Ajouter un établissement pour le client </legend>
          <div id="new_etab">
            <% cpt = 1 %>
            <% unless params[:new_establishment_number].nil? %>
            <% new_establishment_number.times do |i| %>
            <div id="link_add_remove<%= i+1 %>">
            </div>
            <div id =<%= "new_form#{i+1}" %>>
            <%= render :partial => 'customer_new_establishment', :locals => {:i => i} %>
            </div>
            <% cpt += 1 %>
            <% end %>
            <% end %>          
            <div id="link_add_remove<%= cpt%>">
            <%= link_to_remote("Ajouter", :url => {:action => "add_form", :cpt => cpt}) %>
            </div>
          </div>
        </fieldset>
    </fieldset>
    <%= customer.submit  'Modifier' %>
    <% end %>
    <%= link_to 'Retour', :action => 'index' %>