<h1>Modifier un client </h1>

<div class="frame presentation_medium">
<% form_for(@customer,  :html => { :multipart => true}) do |customer| %>
    
  <%= customer.error_messages %>
  <% #Display customer infos%>
  <%= render :partial => 'thirds/third', :locals => {:third => customer, :third_ => @customer, :activity_sector_name => @activity_sector} %>

  <!-- Display error messages for establishments -->
  <% if @establishments.length > 0 %>
    <% for establishment in @establishments %>
      <%= error_messages_for("establishment#{establishment.id}") %>
      <%= error_messages_for("establishment#{establishment.id}_address") %>
      <%error_messages_for()%>
    <% end #for%>
  <% end %>

  <!-- Display Establishments div -->
  <h2> &Eacute;tablissements </h2>
  <% for establishment in @establishments %>
    <% unless establishment.activated == false %>
      <div  id='<%="customer_establishment#{establishment.id}"%>'>
        <%= establishment.name + "(" + establishment.address.city_name + ")"%>
        <%= link_to "Plus d'infos", edit_customer_establishment_path(@customer, establishment, :owner_type => "Customer") %>
      </div>
    <% end #unless %>        
  <% end #for %>
  
  <%= render :partial => 'establishments/new_establishment', :locals => {:params => params, :new_establishment_number => @new_establishment_number, 
    :error => @error} %>


  <!-- Display Contacts div -->
  <h2> Contacts</h2>
  <% if @contacts.length > 0 -%>
    <% for contact in @contacts%>
      <div <%= "id='customer_contact#{contact.id}'" %>>
        <%= contact.first_name + " " + contact.last_name%>
        <%= link_to "Plus d'infos", edit_customer_contact_path(@customer, contact, :owner_type => "Customer") %>
        <%= link_to("Supprimer", [@customer, contact], :method => :delete, :confirm => 'Etes vous sÃ»r ?') %>
      </div>
    <%end #for%> 
  <%end #if%>
  <%= render :partial => 'contacts/new_contact', :locals => {:owner_type => "Customer",
                  :owner_id => @customer.id, :params => params, :new_contact_number => @new_contact_number,
                  :error => @error} %>

  <%= customer.submit  'Modifier' %>
<% end %>

  <!-- Display Documents div -->
  <h2>Documents</h2>
  <%unless @customer.documents.empty?%>  
    <% for document in @customer.documents%>
      <br/>
      <%= image_tag("/images/file_extensions/#{document.extension}_16x16.png") %>
      <%= link_to document.name, customer_document_path(@customer, document) %>      
      <%= link_download_last_version(document) %>
    <%end%>
  <%end%>
  <!-- Display document_form-->
  <%= get_document_form(@customer) %>

  <%= link_to 'Retour', :action => 'index' %>
</div>
