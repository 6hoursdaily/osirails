<h4>Modifier un client </h4>
<% form_for(@customer) do |customer| %>
  <%= customer.error_messages %>
  <%= render :partial => 'thirds/third', :locals => {:third => customer, :type => "client"} %>

  <% if @establishments.length > 0 %>
    <fieldset>
      <legend> Informations concernant les établissement du client </legend>
      <%for establishment in @establishments%>
        <%cpt ||= 0%>
        <%cpt += 1%>
        <%= error_messages_for(:establishment) %>
        <p><%= label :establishment, "Nom de l'etablissement" %><br/>
        <%= text_field("establishment","name", "index" => cpt, "value" => establishment.name)%></p>
          <p><%= label :address, "Type de client" %><br/>
          <%= select("establishment", "establishment_type_id",EstablishmentType.find(:all).collect {|a| [ a.wording, a.id ] },{"include_blank" => 'None'}, { "index" => cpt })%></p>
          <%=hidden_field("establishment", "id", "index" => cpt, "value" => establishment.id)%>
          <p><%= label :address, "Address1" %><br/>
          <%= text_field("establishment_address","address1","index" => cpt, "value" => establishment.address.address1)%></p>
          <p><%= label :address, "Address2" %><br/>
          <%= text_field("establishment_address","address2","index" => cpt, "value" => establishment.address.address1)%></p>
            <p><%= label :address, "city_id" %><br/>
            <%= select("establishment_address", "city_id",City.find(:all).collect {|a| [ a.name, a.id ] },{"include_blank" => 'None'}, { "index" => cpt })%></p>
            <%=hidden_field("establishment_address", "id", "index" => cpt, "value" => establishment.address.id)%>
          <% end %>     
          <br/>
        <% end %> 
      </fieldset>

      <%= customer.submit  'Modifier' %>
    <%end%>
    
        <fieldset>
        <legend> Ajouter un établissement pour le client </legend>
        <% form_for(@new_establishment) do |f| %>
        <p><%= f.label :new_customer_name, "Nom de l'établissement" %><br/>
        <%= f.error_messages%>
        <%= f.text_field :name  %></p>
        <%= f.submit 'Ajouter'%>
<% end %>
      </fieldset>

    <%= link_to 'Retour', :action => 'index' %>
