<% params[:new_contact_number].nil? ? new_contact_number = 0 : new_contact_number = new_contact_number -%>
<%= hidden_field("new_contact_number", "value", "value" => new_contact_number) %>

<% unless params[:new_contact_number].nil? -%>        
  <% new_contacts_number = params[:new_contact_number]["value"].to_i -%>
<% end -%>
<fieldset>
  <legend> Ajouter un nouveau contact pour le client </legend>

    <div id="new_contact">
      <% # If an error occure, old form are recreate with same values%>
      <%unless error%>
        <div id="link_add_remove_contact_1">
          <%= link_to_remote("(+)", :url => {:controller => "contacts",:action => "add_contact", :cpt => 1, 
                  :owner_id => owner_id, :owner_type => owner_type}) %>
        </div> 
      <%end%>
      <% # cpt store the number of form %>
      <% cpt = 1 %>
          
      <% unless params[:new_contact_number].nil? %>
        <% new_contacts_number.times do |i| %>
          <%unless params["valid_contact_#{i+1}"].nil?%>
            <%unless params["valid_contact_#{i+1}"]["value"] == "false"%>
              <div <%= "id ='new_contact#{i+1}'" %>>
              
                <% params["owner_id"]= owner_id%>
                <%params["owner_type"] = owner_type%>       

                <% # get_new_contact_form return a new contact_form with the same value that older%>
                <%= get_new_contact_form(cpt, params, error)%>


                <% # unless a form content was in show position %>
                <%unless params["new_contact#{i+1}"]["id"].to_i == 0%>
                <div id="contact_<%=i+1%>_show_info" style='display: block;'>
                <%= get_new_contact_info(params["new_contact#{i+1}"]["id"].to_i, cpt)%>
                </div>
                <% # The contact_form input is hide%>
                <%=javascript_tag "document.getElementById('contact_#{cpt}_input_info').style.display = 'none'"%>
                <%end%>              
 
              </div> <% #new_contact_cpt%>

            <%end #unless%>
          <%end #unless%>
        <% cpt += 1 %>
      <% end #unless%>
    
      <div id='link_add_remove_contact_<%=cpt%>'>
        <%= link_to_remote("(+)", :url => {:controller => "contacts",:action => "add_contact", :cpt => cpt, 
              :owner_id => owner_id, :owner_type => owner_type}) %>
      </div>
    <% end %>
  </div> <% #new_contact%>
</fieldset>