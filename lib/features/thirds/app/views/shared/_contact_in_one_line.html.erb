<% owner_type = contacts_owner.class.name.downcase %>

<div class="contact_general_infos">
<% fields_for "#{owner_type}[contact_attributes][]", contact = contact_in_one_line do %>
  <p id="contact_<%= contact.id  %>">
    <%= image_tag 'warning_14x14.png' if contact.new_record? or !contact.errors.empty? %>
    
    <%= "#{contact.fullname}" %>
    
    <%= link_to_function "Modifier", "mark_contact_for_update(this.up('.contact_general_infos'))" if is_edit_view? and menu_contacts.can_edit?(current_user) %>
    
    <% if is_edit_view? and menu_contacts.can_delete?(current_user) %>
      <% if contact.new_record? %>
        <%= link_to_function "Supprimer", "this.up('.contact_general_infos').remove()" %>
      <% else %>
        <%= link_to_function "Supprimer", "if (confirm('Êtes-vous sûr? La suppression prendra effet uniquement après validation du formulaire.')) mark_contact_for_destroy('contact_form_#{contact.id}')" %>
      <% end %>
    <% end %>

    <%= render :partial => 'shared/contact_form', :object => contact || Contact.new, :locals => { :contacts_owner => contacts_owner } %>
  </p>
<% end  %>
</div>