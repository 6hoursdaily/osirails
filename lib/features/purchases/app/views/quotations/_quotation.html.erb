<% content_for :header do %>
  <%= stylesheet_link_tag_with_theme_support 'core/has_resources/has_resources' %>
  <%= stylesheet_link_tag_with_theme_support 'core/has_contacts/has_contacts' %>
  <%= stylesheet_link_tag_with_theme_support 'core/has_contacts/has_contacts' %>
  <%= stylesheet_link_tag_with_theme_support 'purchases/purchases' %>
  <%= stylesheet_link_tag_with_theme_support "thirds/thirds" %>
  <%= javascript_include_tag 'core/has_resources/has_resources' %>
  <%= javascript_include_tag 'sales/sales' %>
  <%= javascript_include_tag 'purchases/purchases' %>
  <%= javascript_include_tag 'sales/sales' %>
<% end %>

<% supplier = quotation.supplier %>

<%
quotation_headers = { :quotation_informations             => "Informations générales",
                      :quotation_supplies_list            => "Liste des produits (#{quotation.quotation_supplies.reject{ |qrs| qrs.should_destroy?}.count})",
                      :quotation_supplier_contacts        => "Contact fournisseur",
                      :quotation_additional_informations  => "Informations supplémentaires"}

quotation_errors  = { :quotation_informations       => quotation.errors.on(:supplier_id)          || quotation.errors.on(:supplier)         ||
                                                       quotation.errors.on(:supplier_contact_id)  || quotation.errors.on(:supplier_contact) ||
                                                       quotation.errors.on(:status)               || quotation.errors.on(:reference)        ||
                                                       quotation.errors.on(:title) ? ' errors' : '',
                      :quotation_supplies_list      => quotation.errors.on(:quotation_supplies) ? ' errors' : '',
                      :quotation_supplier_contacts  => quotation.errors.on(:name)                 || quotation.errors.on(:supplier_contact_id) ? ' errors' : '' }
%>

<div class="presentation_medium root_nav">
  <ul class="quotation_nav tab_nav">
    <li class="quotation_informations<%= quotation_errors[:quotation_informations] %> selected">
      <%= quotation_headers[:quotation_informations ] %>
    </li>
    
    <li class="quotation_supplies_list<%= quotation_errors[:quotation_supplies_list] %>">
      <%= quotation_headers[:quotation_supplies_list ] %>
    </li>
    
    <li class="quotation_supplier_contacts<%= quotation_errors[:quotation_supplier_contacts] %>">
      <%= quotation_headers[:quotation_supplier_contacts ] %>
    </li>
    
    <li class="quotation_additional_informations">
      <%= quotation_headers[:quotation_additional_informations ] %>
    </li>
  </ul>
  
  <% form_for quotation, :html => {:multipart => true} do |f| %>
    <%= f.error_messages %>
    
    <h2 class="quotation_informations section_nav"><%= quotation_headers[:quotation_informations] %></h2>
    <div class="quotation_informations section_nav selected">
      <%= render :partial => "quotation_informations", :object => quotation, :locals => { :f => f, :supplier => supplier } %>
    </div>
    
    <h2 class="quotation_supplies_list section_nav"><%= quotation_headers[:quotation_supplies_list] %></h2>
    <div class="quotation_supplies_list section_nav">
      <%= render :partial => 'quotation_supplies/quotation_supplies', :locals => { :quotation => quotation }  %>
    </div>
    
    <h2 class="quotation_supplier_contacts section_nav"><%= quotation_headers[:quotation_supplier_contacts] %></h2>
    <div class="quotation_supplier_contacts section_nav">
      <% if supplier %>
        <% if is_form_view? %>
          <%= label :select_contacts, "À l'attention de" %>
          <%= #display_contact_picker(quotation, supplier.contacts, :contact_key => 'supplier_contact', :contacts_owners => [supplier]) 
          %>
        <% else %>
          <%= display_contact(quotation.supplier_contact) if quotation.supplier_contact_id %>
        <% end %>
      <% end %>
    </div>
    
    <h2 class="quotation_additional_informations section_nav"><%= quotation_headers[:quotation_additional_informations] %></h2>
    <div class="quotation_additional_informations section_nav">
      <%= render :partial => "additional_info", :object => quotation, :locals => { :form  => f } %>
    </div>
  
    <%= f.form_buttons %>
  <% end %>
</div>
