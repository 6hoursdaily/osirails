<% collection_length ||= 1 %>

<% fields_for 'invoice[invoice_item_attributes][]', invoice_item, :index => nil do |form| %>
  <% form.force_form_view = (params[:action] == "ajax_request_for_invoice_items") %>
  
  <% if invoice_item.free_item? %>
    <%= render :partial => 'invoice_items/free_invoice_item', :object => invoice_item,
                                                              :locals => { :collection_length => collection_length,
                                                                           :counter           => invoice_item_counter,
                                                                           :form              => form } %>
  <% else %>
    <%= render :partial => 'invoice_items/product_invoice_item', :object => invoice_item,
                                                                 :locals => { :collection_length  => collection_length, 
                                                                              :counter            => invoice_item_counter,
                                                                              :form               => form } %>
  <% end %>
  
<% end %>
