<% content_for :header do %>
  <%= javascript_include_tag 'sales/delivery_notes' %>
  <%= javascript_include_tag 'sales/sales' %>
  <%= stylesheet_link_tag_with_theme_support 'sales/delivery_note' %>
<% end %>

<%= generate_delivery_note_contextual_menu_partial %>

<%
delivery_note_errors  = { :header => delivery_note.errors.on(:published_on) || delivery_note.errors.on(:ship_to_address) || delivery_note.errors.on(:contacts) ? ' errors' : '',
                          :body   => delivery_note.errors.on(:delivery_note_items) ? ' errors' : ''}
%>

<div class="presentation_medium root_nav standard">
  
  <% tab_navigator :delivery_note_nav do |t| %>
    <% t.nav_buttons do %>
      <%= t.tab :header,                  "Entête", :class    => delivery_note_errors[:header],
                                                    :selected => true %>
      <%= t.tab :body,                    "Corps",  :class    => delivery_note_errors[:body] %>
      <%= t.tab :interventions,           "Interventions (#{delivery_note.delivery_interventions.count})" %>
      <%= t.tab :additional_informations, "Informations supplémentaires" %>
    <% end %>
  
    <% action = delivery_note.new_record? ? :create : :update %>
    <% method = delivery_note.new_record? ? :put : :post %>
    <% form_for delivery_note, :url => { :controller => 'delivery_notes', :action => action, :order_id => @order.id }, :method => method, :html => { :multipart => true } do |form| %>
    
      <% t.content_for :header do %>
        <%= form.error_messages unless delivery_note_errors[:header].blank? %>
        <%= render :partial => 'delivery_note_header', :object => delivery_note, :locals => { :form => form } %>
      <% end %>
      
      <% t.content_for :body do %>
        <%= form.error_messages unless delivery_note_errors[:body].blank? %>
        <%= render :partial => 'delivery_note_body', :object => delivery_note %>
      <% end %>
      
      <% t.content_for :interventions do %>
        <%= render :partial => 'delivery_note_interventions', :object => delivery_note %>
      <% end %>
      
      <% t.content_for :additional_informations do %>
        <%= render :partial => 'delivery_note_additional_infos', :object => delivery_note, :locals => { :form => form } %>
      <% end %>
      
      <%= form.form_buttons %>
    <% end %>
  <% end %>
  
</div>
