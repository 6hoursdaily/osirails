<br/>
<% form_for(@employee) do |f| %>
  <%= f.error_messages %> 
  <div class="cadre">
  <h2>Informations personnelles</h2>
    <p>
      <%= f.label :civility, "Civilité :"%>
      <%= collection_select(:employee, :civility_id, Civility.find(:all), :id, :name)%>  
    </p>
    <p>
      <%= f.label :last_name, "Nom :"%>
      <%= f.text_field :last_name %>
    </p>
    <p>
      <%= f.label :first_name, "Prénom :"%>
      <%= f.text_field :first_name %>
    </p>
    <p>
      <%= f.label :birth_date, "Date de naissance :"%>
      <%= f.date_select :birth_date, :start_year => 1900, :order => [:day,:month,:year]%>
    </p>
    <p>
      <%= f.label :family_situation, "Situation familiale :"%>
      <%= collection_select(:employee, :family_situation_id, FamilySituation.find(:all), :id, :name)%>
    </p>
    <p>
      <%= f.label :social_security ,"N° sécurité sociale :"%>
      <%= f.text_field :social_security , { :size => 14, :maxlength => 16, :class => "disable-stylesheet-width"} %>
    </p>
  </div>
  <!--#####################################-->
  <div class="cadre">
  <h2>Emails</h2>
  <p>
    <%= f.label :email, "Email personnel :"%>
    <%= f.text_field :email%>
  </p>
  <p>
    <%= f.label :society_email, "Email professionnel :"%>
    <%= f.text_field :society_email%>
  </p>
  </div>
  <!--#####################################-->
  <div class="cadre">
  <h2>Coordonn&eacute;es</h2>
    <p>
      <%= label_tag 'address[address1]', "Adresse :"%> 
      <%= display_address1(@address.nil? ? nil :@address[:address1] )%>
    </p>
    <p>
      <%= label_tag 'address[address2]', "Adresse :"%> 
      <%= display_address2(@address.nil? ? nil :@address[:address2] )%>    
    </p>
    <%= render :partial => 'addresses/address', 
      :locals => {:cpt=> 1, :owner_address => @employee.address}%>

  </div> 
  <!--#####################################-->
  
  <div class="cadre" id='add_lines'>
  <h2>Num&eacute;ros</h2>
    <% unless @numbers.nil?%>
      <%number_id=0%>
      <% for number in @numbers %>
         <%= display_p_balise(number_id) %>
         
         <%= select('numbers[' + number_id.to_s + ']',:indicative_id,  Indicative.find(:all).collect {|p| [ p.indicative, p.id ] }, :selected => number[:indicative_id])%>
         <%= text_field_tag 'numbers[' + number_id.to_s + '][number]', number[:number],:size => 7, :maxlength => 9, :class=>"disable-stylesheet-width" %>
         <%= select('numbers[' + number_id.to_s + ']',:number_type_id,  NumberType.find(:all).collect {|p| [ p.name, p.id ] }, :selected => number[:number_type_id])%>
         <%= link_to_remote( 'Enlever le numéro',:url=>{:action=>'remove_line', :rem => number_id  },:href=>(url_for :action=>'remove_line'))%>
        </p>
        <%number_id+=1%>
      <%end%>  
      <p>
        <span id='add_link'><%= link_to_remote "Ajouter un numéro...",:url=>{:action=>"add_line", :opt => params[:numbers].nil? ? @numbers.size : params[:numbers].size  },:href=>(url_for :action=>"add_line")%></span>
      </p>
    <%else%>
      <p>
        <%= select('numbers[0]',:indicative_id,  Indicative.find(:all).collect {|p| [ p.indicative, p.id ] }, :selected => "2")%>
        <%= display_number0 %>
        <%= select('numbers[0]',:number_type_id,  NumberType.find(:all).collect {|p| [ p.name, p.id ] }, :selected =>"2")%>
        <%= save_lines%>
      </p>
      <p>
        <span id='add_link'><%= link_to_remote "Ajouter un numéro...",:url=>{:action=>"add_line", :opt => params[:numbers].nil? ? 1 : params[:numbers].size  },:href=>(url_for :action=>"add_line")%></span>
      </p>  
     <%end%> 
  </div>
  <!--#####################################-->
  <div class="cadre">
  <h2>Informations Bancaires</h2>
  <p>
    <%= label_tag 'iban[bank_code]' ,"Code bancaire :"%> 
    <%= display_bank_code(@iban.nil? ? nil :@iban[:bank_code])%>
  </p>
  <p>
    <%= label_tag 'iban[teller_code]' ,"Code guichet :"%> 
    <%= display_teller_code(@iban.nil? ? nil :@iban[:teller_code])%>
  </p>
   <p>
    <%= label_tag 'iban[account_number]' ,"N° de compte :"%> 
    <%= display_account_number(@iban.nil? ? nil :@iban[:account_number])%>
  </p>
   <p>
    <%= label_tag 'iban[key]' ,"Clée :"%> 
    <%= display_key(@iban.nil? ? nil :@iban[:key])%>
  </p>
   <p>
    <%= label_tag 'iban[holder_name]' ,"Nom du titulaire :"%> 
    <%= display_holder_name(@iban.nil? ? nil :@iban[:holder_name] ) %>
  </p>
  </div>

  <div class="cadre">
    <h2>Fiche de poste</h2>
    <p>
      <div>
      <table>
        <tr>
          <th colspan="2">Services</th>
          <th>Responsable?</th>
        </tr>      
        <% for associated_service in @services %>
          <tr>
            <td>
              <%= check_box_tag "employee[service_ids][]", associated_service.id, is_in?( associated_service, 'services','service_ids',@numbers.nil? ? nil : @employee )%> <!-- @numbers is define only in 'edit' and 'update' methods then if it is null we are using 'new' or 'create' method -->
            </td>
            <td>
              <%= associated_service.name %>
            </td>
            <td>
              <%= check_box_tag "responsable[" + associated_service.id.to_s + "]", associated_service.id, is_resonsable_of_this_service?(associated_service.id,@numbers.nil? ? nil : @employee)%>
            </td>
          </tr>
        <% end %>
      </table>
    </div>
    </p>
    <div id="jobs_choice">
    <a id="job_list_anchor"></a>
      <div id='jobs_list'>
        <table>
          <tr>
            <th colspan="2">Fonctions</th>
          </tr>
          <% for associated_job in @jobs %>
            <tr>
              <td>
                <%= check_box_tag "employee[job_ids][]", associated_job.id, is_in?(associated_job, 'jobs','job_ids',@numbers.nil? ? nil : @employee)%>
              </td>
              <td>
                <%= associated_job.name %>
              </td>
            </tr>
          <% end %>
        </table>
      </div>
    </div>
    <%=link_to_remote "Ajouter une fonction",:url=>{:action=>"job_form"},:href=>(url_for :action=>"job_form"), :html => {:id=>'job_add_link', :onclick=>"document.getElementById('job_add_anchor').scrollTo();"}%>
    <a href="#anchor">t</a>
    <a onclick="osibox_open();">Ajouter une fonction avec osibox</a>
  </div> 
  <span id="main_submit">
    <%= f.submit button_name %>
    <%= link_to 'Retour', employees_path %>
  </span>
<% end %>


<!-- enlever pour demo avec osibox-->
  <a id="job_add_anchor"></a>
 <div id="job_add" style="display:none;" class="cadre">
 <h2>Ajout de fonction</h2>
      <%form_remote_for(@job,:html=>{:id=>'job_add_form'}) do |j|%>
        <%=j.error_messages%>
      <p style="display:none">
        <%= hidden_field_tag 'employee_id',params[:id].nil? ? nil : params[:id]%>
      </p>  
      <p class="text_form">
        <%= j.label :name, "Nom :"%>
        <%= j.text_field :name%>
      </p>
      <p class="text_form">
        <%= j.label :mission, "Mission :"%>
        <%= j.text_area :mission %>
      </p>
      <p class="text_form">
        <%= j.label :activity, "Activités :"%>
        <%= j.text_area :activity%>
      </p>
      <p class="text_form">
        <%= j.label :goal, "Objectifs :"%>
        <%= j.text_area :goal%>
      </p>
      <%= j.submit 'Ajouter une fonction',{ :onclick=>"document.getElementById('job_list_anchor').scrollTo();"}%>
      <%=link_to_remote "Annuler",:url=>{:action=>"job_form_cancel"},:href=>(url_for :action=>"job_form_cancel"),:html=>{ :onclick=>"document.getElementById('job_list_anchor').scrollTo();"}%>
      <%end%>
    </div>
    
<%= osibox_init :partial => 'job_form'%>


