<div class="presentation_medium">
<% form_for(leave_request, :html => {:multipart => true}) do |f| %>
  
  <!--############## SHOW : Leave informations / FORM : Leave period ##############-->
  
  <% if !is_form_view? or [1,-2,2,3,-4,4].include?(leave_request.status_was)%>
 
    <%= "<h2>Informations</h2>" %>
    <p>
      <%= f.label :status %>
      <%= f.strong view_status(leave_request) %>
    </p>
    
    <p>
      <%= f.label :employee %>
      <%= link_to "#{leave_request.employee.first_name} #{leave_request.employee.last_name}", employee_path(@employee) %>
      <%=  f.label(leave_request.employee.services.size<=1 ? "Service":"Services") %>
      <%for service in leave_request.employee.services %>
        <%=link_to service.name, service_path(service.id) %> 
      <% end %>   
    </p>
    <p>
      <%= f.label :created_at %>
      <%= f.strong leave_request.created_at.to_datetime.strftime("%A %d %B %Y à %Hh%M") %>
    </p>
    <p>
      <%= f.label :period %>
      <%= f.strong view_dates(leave_request) %>
    </p>
    
    <p>
      <%= f.label :leave_type %>
      <%= f.strong @leave_type %>
    </p>
    <p>
      <%= f.label :comment%>
      <% if leave_request.comment.nil? or leave_request.comment == ""  %>
        <%= f.strong "aucun" %>
      <% else %>
        <%= f.strong leave_request.comment %>
      <% end %>
    </p>
  <% end %>
  
  </p>
  
  <% if is_form_view? and leave_request.status_was == nil %>
    <%= f.hidden_field(:employee_id, :value => @employee_id) %>  
    
    <%= "<h2>Période du congé</h2>" %>
    <%= f.error_messages %> 
    <p>
      <%= f.label:start_date %>
      <%= f.date_select( :start_date,{ :start_year => Date.today.year, :order => [:day,:month,:year] }) %>
      <%= f.label :start_half %>
      <%= f.check_box(:start_half) %>
    </p>
    <p>
      <%= f.label :end_date %>
      <%= f.date_select( :end_date,{ :start_year => Date.today.year, :order => [:day,:month,:year] }) %>
      <%= f.label :end_half %>
      <%= f.check_box(:end_half) %>
    </p>
  <% end %>
  
  <!--############## SHOW : Responsible check / FORM : Leave type ##############-->
  
  <% if (!is_form_view? and [-2,2,3,-4,4].include?(leave_request.status_was)) or (is_form_view? and [2,3,4,-4].include?(leave_request.status_was)) %>
    <%= "<h2>Réponse du responsable</h2>" %>
    <p>  
      <%= f.label :responsible_agreement %>
      <%= f.strong view_responsible_agreement(leave_request) %>   
      <%= f.label :responsible %>
      <%= link_to "#{leave_request.responsible.first_name} #{leave_request.responsible.last_name}", employee_path(leave_request.responsible) %>
    </p>
    <p> 
      <%= f.label :checked_at %>
      <%= f.strong leave_request.checked_at.to_datetime.strftime("%A %d %B %Y à %Hh%M") %>
    </p>
    <p>
      <%= f.label :responsible_remarks%>
      <% if leave_request.responsible_remarks.nil? or leave_request.responsible_remarks == ""  %>
        <%= f.strong "aucun" %>
      <% else %>
        <%= f.strong leave_request.responsible_remarks %>
      <% end %>
    </p>
  <% end %>
  
  <% if is_form_view? and leave_request.status_was == nil %>
    <%= "<h2>Type du congé</h2>" %>
    <p>  
      <%= f.label("Congés payés") %>
      <%= f.radio_button(:leave_type_id, 1) %>
      <%= f.label("Congés de formation") %>
      <%= f.radio_button(:leave_type_id, 2) %>    
      <%= f.label("Congé paternité") %>
      <%= f.radio_button(:leave_type_id, 3) %>
      <%= f.label("Congés d'examen") %>
      <%= f.radio_button(:leave_type_id, 4) %>    
    </p>  
    <p>
      <%= f.label("Commentaire (facultatif)") %>
      <%= f.text_area(:comment, :rows => 5) %> 
    
    <p>
      <%= f.reset "Réinitialiser" %>
      <%= f.submit button_name %>
    </p>
  <% end %>
  
<% end %>
  
<% form_for(leave_request, :html => {:multipart => true}) do |f| %> 
  
  <!--############## SHOW : Observer notification / FORM : Responsible check ##############-->
  
  <% if !is_form_view? and [3,-4,4].include?(leave_request.status_was) or (is_form_view? and [3,-4,4].include?(leave_request.status_was)) %>
    <%= "<h2>Observation des ressources humaines</h2>" %>
    <p>  
      <%= f.label :acquired_leaves_days %>
      <%= f.strong "#{leave_request.acquired_leaves_days} jours" %>   
      <%= f.label :observer %>
      <%= link_to "#{leave_request.observer.first_name} #{leave_request.observer.last_name}", employee_path(leave_request.observer) %>  
    </p> 
    <p>
      <%= f.label :noticed_at %>
      <%= f.strong leave_request.noticed_at.to_datetime.strftime("%A %d %B %Y à %Hh%M") %>
    </p>  
    <p>
      <%= f.label :observer_remarks %>
      <%= f.strong leave_request.observer_remarks %> 
    </p>   
  <% end %>
  
  <% if is_form_view? and leave_request.status_was == 1 %>
    <%= f.hidden_field(:responsible_id, :value => current_user.employee.id) %>   
    <%= f.hidden_field(:checked_at, :value => Time.now) %> 
  
    <%= "<h2>Réponse du responsable</h2>"%>
    <%= f.error_messages %>
    <p>  
      <%= f.label("Accord") %>
      <%= f.radio_button(:responsible_agreement, "true") %>
      <%= f.label("Refus") %>
      <%= f.radio_button(:responsible_agreement, "false") %>     
    </p>  
    <p>
      <%= f.label("Commentaire") %>
      <%= f.text_area(:responsible_remarks, :rows => 5) %> 
    </p>
    <p>
      <%= f.reset "Réinitialiser" %>
      <%= f.submit button_name %>
    </p>
  <% end %>
  
  <!--############## SHOW : Director close / FORM : Observer notification ##############-->
  
  <% if !is_form_view? and [-4,4].include?(leave_request.status_was) %>
    <%= "<h2>Réponse de la direction</h2>" %>
    <p>  
      <%= f.label :director_agreement %>
      <%= f.strong view_director_agreement(leave_request) %>   
      <%= f.label :director %>
      <%= link_to "#{leave_request.director.first_name} #{leave_request.director.last_name}", employee_path(leave_request.director) %>
    </p>
    <p> 
      <%= f.label :ended_at %>
      <%= f.strong leave_request.ended_at.to_datetime.strftime("%A %d %B %Y à %Hh%M") %>
    </p>
    <p>
      <%= f.label :director_remarks%>
      <% if leave_request.director_remarks.nil? or leave_request.director_remarks == ""  %>
        <%= f.strong "aucun" %>
      <% else %>
        <%= f.strong leave_request.director_remarks %>
      <% end %>
    </p>
  <% end %>
  
  <% if is_form_view? and leave_request.status_was == 2 %>
    <%= f.hidden_field(:observer_id, :value => current_user.employee.id) %>   
    <%= f.hidden_field(:noticed_at, :value => Time.now) %> 
  
    <%= "<h2>Observation des ressources humaines</h2>"%>
    <%= f.error_messages %>
    <p>  
      <%= f.label :acquired_leaves_days %>
      <%= f.text_field(:acquired_leaves_days, :size => 1) %> jours 
    </p>  
    <p>
      <%= f.label :observer_remarks %>
      <%= f.text_area(:observer_remarks, :rows => 5) %>  
    </p>
    <p>
      <%= f.reset "Réinitialiser" %>
      <%= f.submit button_name %>
    </p>
  <% end %>
  
  <!--############## FORM : Director close ##############-->
  
  <% if is_form_view? and [-4,3].include?(leave_request.status_was) %>
    <%= f.hidden_field(:director_id, :value => current_user.employee.id) %>   
    <%= f.hidden_field(:ended_at, :value => Time.now) %> 
  
    <%= "<h2>Réponse de la direction</h2>"%>
    <%= f.error_messages %>
    <p>  
      <%= f.label("Accord") %>
      <%= f.radio_button(:director_agreement, "true") %>
      <%= f.label("Refus") %>
      <%= f.radio_button(:director_agreement, "false") %>     
    </p>  
    <p>
      <%= f.label("Commentaire") %>
      <%= f.text_area(:director_remarks, :rows => 5) %> 
    </p>
    <p>
      <%= f.reset "Réinitialiser" %>
      <%= f.submit button_name %>
    </p>
  <% end %>
  
<% end %>
</div>
