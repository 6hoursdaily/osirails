<% form_for(@employee, :html => {:multipart => true}) do |f| %>
  <%= f.error_messages %> 
  <h2>Fiche d&apos;identit√©</h2>
  <p>
    <%= f.label :civility, "Civilit&eacute; :"%>
    <%= collection_select(:employee, :civility_id, Civility.find(:all), :id, :name)%>  
  </p>
  <p>
    <%= f.label :last_name, "Nom :"%>
    <%= f.text_field :last_name %>
  </p>
  <p>
    <%= f.label :first_name, "Pr&eacute;nom :"%>
    <%= f.text_field :first_name %>
  </p>
  <p>
    <%= f.label :birth_date, "Date de naissance :"%>
    <%= f.date_select :birth_date, :start_year => 1900, :order => [:day,:month,:year]%>
  </p>
  <p>
    <%= f.label :family_situation, "Situation familiale :"%>
    <%= collection_select(:employee, :family_situation_id, FamilySituation.find(:all), :id, :name)%>
  </p>
  <p>
    <%= label_tag 'social_security_number' ,"N&deg; s&eacute;curit&eacute; sociale :"%>
    <%= display_social_security(@employee.nil? ? nil : @employee[:social_security_number]) %>
  </p>
  <!--#####################################-->

  <h2>Coordonn&eacute;es</h2>
  <h3>Adresse postale</h3>
  <p>
    <%= label_tag 'employee[address][address1]', "Adresse :"%> 
    <%= display_address1(@address.nil? ? nil : @address[:address1] )%> - <%= display_address2(@address.nil? ? nil : @address[:address2] )%>
  </p>
  <%= render :partial => 'addresses/address', :locals => {:cpt=> 1, :owner_address => @employee.address, :address_name => "employee"} %>
  
  <h3>Adresses &eacute;lectroniques</h3>
  <p>
    <%= f.label :email, "Email personnel :"%>
    <%= f.text_field :email%>
  </p>
  <p>
    <%= f.label :society_email, "Email professionnel :"%>
    <%= f.text_field :society_email%>
  </p>
  <h3>Num&eacute;ros de t&eacute;l&eacute;phone</h3>
  <%= render :partial => 'numbers', :locals => {:attribute=> 'employee'}%>
  <!--#####################################-->
  
  <h2>Coordonn&eacute;es bancaires</h2>
  <p>
    <%= label_tag 'iban[bank_name]' ,"Nom de la banque :"%> 
    <%= display_bank_name(@iban.nil? ? nil : @iban[:bank_name])%>
  </p>
  <p>
    <%= label_tag 'iban[bank_code]' ,"Code bancaire :"%> 
    <%= display_bank_code(@iban.nil? ? nil : @iban[:bank_code])%>
  </p>
  <p>
    <%= label_tag 'iban[branch_code]' ,"Code guichet :"%> 
    <%= display_branch_code(@iban.nil? ? nil : @iban[:branch_code])%>
  </p>
   <p>
    <%= label_tag 'iban[account_number]' ,"N&deg; de compte :"%> 
    <%= display_account_number(@iban.nil? ? nil : @iban[:account_number])%>
  </p>
   <p>
    <%= label_tag 'iban[key]' ,"Cl&eacute; :"%> 
    <%= display_key(@iban.nil? ? nil : @iban[:key])%>
  </p>
   <p>
    <%= label_tag 'iban[account_name]' ,"Nom du titulaire :"%> 
    <%= display_account_name(@iban.nil? ? nil : @iban[:account_name] ) %>
  </p>

  <h2>Fiche de poste</h2>
  <p>
    <div>
      <table>
        <tr>
          <th colspan="2">Services</th>
          <th>Responsable?</th>
        </tr>      
      <% for associated_service in @services %>
        <tr>
          <td>
            <%= check_box_tag "employee[service_ids][]", associated_service.id, is_in?( associated_service, 'services','service_ids',@numbers.nil? ? nil : @employee )%> <!-- @numbers is define only in 'edit' and 'update' methods then if it is null we are using 'new' or 'create' method -->
          </td>
          <td>
            <%= associated_service.name %>
          </td>
          <td>
            <%= check_box_tag "responsable[" + associated_service.id.to_s + "]", associated_service.id, is_resonsable_of_this_service?(associated_service.id,@numbers.nil? ? nil : @employee)%>
          </td>
        </tr>
      <% end %>
      </table>
    </div>
  </p>
  <div id="jobs_choice">
    <div id='jobs_list'>
      <table>
        <tr>
          <th colspan="2">Fonctions</th>
        </tr>
      <% for associated_job in @jobs %>
        <tr>
          <td>
            <%= check_box_tag "employee[job_ids][]", associated_job.id, is_in?(associated_job, 'jobs','job_ids',@numbers.nil? ? nil : @employee)%>
          </td>
          <td>
            <%= associated_job.name %>
          </td>
        </tr>
      <% end %>
      </table>

    </div>
    <p>
      <a onclick="osibox_open();" style="text-decoration:underline;">Ajouter une fonction</a>
    </p>
  <!-- Display Documents div -->
  <%= display_documents_and_add_documents_button(@employee, @documents, params, @new_document_number, @error) %>
    
    
    <span id="main_submit">
      <button type=submit class="input-button">
  	    <span><%= button_name %></span>
      </button>
      <%= link_to 'Retour', employees_path %>
    </span>
  </div>

<% end %>


 
  
 
   
<%= osibox_init :partial => 'job_form', :border_size => '32'%>
